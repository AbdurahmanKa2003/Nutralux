 <!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="images/favicon-32x32.png" type="image/x-icon" />

    <!-- SEO Meta Tags -->
    <title>Nutralux ‚Äî Vitamins and Supplements Store | Buy Vitamin C, Magnesium, Zinc</title>
    <meta name="description" content="Nutralux ‚Äî your reliable online store for vitamins and supplements. We offer quality products: vitamin C, magnesium, zinc, multivitamins, probiotics. Extensive catalog, detailed descriptions, fast delivery worldwide." />
    <meta name="keywords" content="Nutralux, vitamins, supplements, buy vitamins, vitamin C, magnesium, zinc, multivitamins, probiotics, health, supplement store, online vitamin store, immunity supplements, energy vitamins" />
    <meta name="author" content="Nutralux" />
    <link rel="canonical" href="https://yourwebsite.com/index.html" /> <!-- Replace with your actual website URL -->

    <!-- Open Graph Meta Tags (for social networks) -->
    <meta property="og:title" content="Nutralux ‚Äî Vitamins and Supplements Store" />
    <meta property="og:description" content="Nutralux ‚Äî your reliable online store for vitamins and supplements. We offer quality products: vitamin C, magnesium, zinc, multivitamins, probiotics. Extensive catalog, detailed descriptions, fast delivery worldwide." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://yourwebsite.com/index.html" /> <!-- Replace with your actual website URL -->
    <meta property="og:image" content="https://yourwebsite.com/images/avatar.png" /> <!-- Replace with URL of your main image or logo -->
    <meta property="og:locale" content="en_US" />

    <!-- Twitter Card Meta Tags (for Twitter) -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Nutralux ‚Äî Vitamins and Supplements Store" />
    <meta name="twitter:description" content="Nutralux ‚Äî your reliable online store for vitamins and supplements. We offer quality products: vitamin C, magnesium, zinc, multivitamins, probiotics. Extensive catalog, detailed descriptions, fast delivery worldwide." />
    <meta name="twitter:image" content="https://yourwebsite.com/images/avatar.png" /> <!-- Replace with URL of your main image or logo -->

    <!-- box icons -->
    <link rel="stylesheet" href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" />

    <!-- lang icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.11.0/css/flag-icons.min.css" />

    <!-- css -->
    <link rel="stylesheet" href="styles.css" />

    <!-- Schema.org JSON-LD Markup -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Nutralux",
      "url": "https://yourwebsite.com/", <!-- Replace with your website root URL -->
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://yourwebsite.com/catalog.html?q={search_term_string}", <!-- Replace with your search URL if available -->
        "query-input": "required name=search_term_string"
      }
    }
    </script>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Organization",
      "name": "Nutralux",
      "url": "https://yourwebsite.com/", <!-- Replace with your website root URL -->
      "logo": "https://yourwebsite.com/images/favicon-32x32.png", <!-- Replace with your logo URL -->
      "sameAs": [
        "https://wa.me/905332452900",
        "https://www.tiktok.com/@nutraluxlife?_t=ZS-8yvEDo3bZth&_r=1",
        "https://t.me/nutralux",
        "https://clck.ru/3NQNkm"
      ],
      "contactPoint": {
        "@type": "ContactPoint",
        "telephone": "+905332452900",
        "contactType": "customer service",
        "areaServed": "US"
      }
    }
    </script>
   <style>
    #chat-widget {
  position: fixed;
  bottom: 90px;
  right: 20px;
  z-index: 9999;
  display: none;
  width: 350px;
  height: 450px;
  background: #fff;
  border: 1px solid #ccc;
  border-radius: 10px;
  box-shadow: 0 4px 15px rgba(0,0,0,0.15);
  display: flex;
  flex-direction: column;
}

#chat-fab {
  position: fixed;
  bottom: 20px;
  right: 90px;
  z-index: 10000;
  display: flex;
  width: 60px;
  height: 60px;
  background: #4CAF50;
  color: white;
  border-radius: 50%;
  justify-content: center;
  align-items: center;
  font-size: 28px;
  cursor: pointer;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.footer-icon-top {
  position: fixed;
  bottom: 20px;
  right: 20px;
  z-index: 10001;
  background: #4CAF50;
  width: 50px;
  height: 50px;
  border-radius: 50%;
  display: flex;
  justify-content: center;
  align-items: center;
  box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}

.footer-icon-top a {
  display: flex;
  justify-content: center;
  align-items: center;
  color: white;
  font-size: 24px;
  line-height: 1;
}

.chat-messages {
  flex-grow: 1;
  padding: 10px 15px;
  overflow-y: auto;
  background-color: #f9f9f9;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.chat-input-container {
  display: flex;
  padding: 10px 15px;
  border-top: 1px solid #eee;
  background-color: #fff;
  flex-shrink: 0;
}

.chat-input-container .chat-input {
  flex-grow: 1;
  padding: 8px;
  border: 1px solid #ccc;
  border-radius: 5px 0 0 5px;
  margin-right: -1px;
  font-size: 14px;
}

.chat-input-container .chat-send {
  background-color: #4CAF50;
  color: white;
  border: none;
  padding: 8px 12px;
  cursor: pointer;
  border-radius: 0 5px 5px 0;
  font-weight: bold;
  flex-shrink: 0;
}

.message {
  max-width: 80%;
  padding: 6px 10px;
  border-radius: 10px;
  word-wrap: break-word;
  font-size: 14px;
}

.bot-message {
  background-color: #e0f2f1;
  align-self: flex-start;
}

.user-message {
  background-color: #4CAF50;
  color: white;
  align-self: flex-end;
}
.chat-container {
    width: 100%;
    height: 100%; /* –ó–∞–Ω–∏–º–∞–µ—Ç –≤—Å—é –≤—ã—Å–æ—Ç—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ #chat-widget */
    display: flex;
    flex-direction: column; /* –≠–ª–µ–º–µ–Ω—Ç—ã (—à–∞–ø–∫–∞, —Å–æ–æ–±—â–µ–Ω–∏—è, –≤–≤–æ–¥) —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ */
    overflow: hidden; /* –í–∞–∂–Ω–æ: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø—Ä–æ–∫—Ä—É—Ç–∫—É –≤—Å–µ–≥–æ –≤–∏–¥–∂–µ—Ç–∞ */
}    
@media (max-width: 600px) {
  #chat-widget {
    width: 90%;
    height: 80%;
    bottom: 80px;
    right: 5%;
    left: 5%;
    border-radius: 15px;
  }
}
.chat-messages::-webkit-scrollbar {
  width: 6px;
}
.chat-messages::-webkit-scrollbar-thumb {
  background-color: #4CAF50;
  border-radius: 3px;
}
    input, textarea, select {
  font-size: 16px !important;
}

html, body {
  overscroll-behavior: none;
  height: 100%;
}

#chat-widget {
  -webkit-transform: translateZ(0);
  position: fixed;
  bottom: 90px;
  right: 20px;
  z-index: 9999;
}

.chat-messages {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  flex-grow: 1;
}

@supports (-webkit-touch-callout: none) {
  #chat-widget {
    position: fixed;
    bottom: env(safe-area-inset-bottom, 90px);
  }
}
  </style>
  </head>

 <body>
    <header class="header">
        <a href="#home" class="logo">Nutralux</a>

        <i class="bx bx-menu" id="menu-icon"></i>

        <nav class="navbar">
            <a href="#about" class="active">About</a>
            <a href="#services" class="active">Services</a>
            <a href="catalog.html" class="active">Catalog</a>
            <a href="#contact" class="active">Contact</a>
            <a href="index-ru.html" class="active lang"><span class="fi fi-ru"></span></a>
        </nav>
    </header>

    <section class="home" id="home">
        <div class="home-content">
            <h1>Nutralux</h1>
            <h3>Store of <span class="multiple-text"></span></h3>
            <p>
                Vitamins and supplements for health: vitamin C, magnesium, zinc, multivitamins, probiotics and more. Quality
                formulations, clear dosage instructions, and personalized selection assistance.
            </p>
            <div class="social-media">
                <a href="https://wa.me/905332452900" target="_blank" aria-label="WhatsApp Nutralux"><i class="bx bxl-whatsapp"></i></a>
                <a href="https://www.tiktok.com/@nutraluxlife?_t=ZS-8yvEDo3bZth&_r=1" target="_blank" aria-label="TikTok Nutralux"><i class="bx bxl-tiktok"></i></a>
                <a href="https://t.me/nutralux" target="_blank" aria-label="Telegram Nutralux"><i class="bx bxl-telegram"></i></a>
                <a href="https://clck.ru/3NQNkm" target="_blank" aria-label="Instagram Nutralux"><i class="bx bxl-instagram"></i></a>
            </div>
            <a href="catalog.html" class="btn">Go to Catalog</a>
        </div>

        <div class="home-img">
            <img src="images/avatar.png" alt="Woman holding a bottle of Nutralux vitamins with green label" />
        </div>
    </section>

    <section class="about" id="about">
        <div class="about-img">
            <img src="images/about-image.png" alt="Collection of various Nutralux vitamin and supplement bottles on white background" />
        </div>

        <div class="about-content">
            <h2 class="heading">About <span>Nutralux Store</span></h2>
            <h3>Supplements and vitamins for daily support</h3>
            <p>
                We select proven supplements with clear compositions and dosages. We help choose complexes for your needs ‚Äî
                immunity, energy, sleep, skin beauty, and much more.
            </p>
            <p>Focus: vitamin C, magnesium, zinc, women's multivitamins, probiotics, and basic complexes.</p>
        </div>
    </section>

    <section class="services" id="services">
        <h2 class="heading">Our <span>Nutralux Services</span></h2>

        <div class="services-container">
            <div class="services-box">
                <i class="bx bx-support"></i>
                <h3>Vitamin Selection Consultation</h3>
                <ul>
                    <li>Help with choosing formulations and dosages</li>
                    <li>Basic intake recommendations</li>
                </ul>
            </div>

            <div class="services-box">
                <i class="bx bx-package"></i>
                <h3>Fast Worldwide Delivery</h3>
                <ul>
                    <li>Same-day order shipping</li>
                    <li>Order status tracking</li>
                </ul>
            </div>

            <div class="services-box">
                <i class="bx bx-check-shield"></i>
                <h3>Quality and Supplement Transparency</h3>
                <ul>
                    <li>Only verified suppliers</li>
                    <li>Clear labels and compositions</li>
                </ul>
            </div>
        </div>
    </section>

    <section class="portfolio" id="portfolio">
        <h2 class="heading">Popular <span>Nutralux Products</span></h2>
    
        <div class="portfolio-container">
            <div class="portfolio-box">
                <div class="portfolio-img">
                    <img src="images/omega-3.jpg" alt="Nutralux Omega-3 1000 mg bottle" />
                </div>
                <div class="portfolio-content">
                    <h4>Omega-3 1000 mg</h4>
                    <p>Brain, heart, and vision support</p>
                    <a href="product.html?slug=omega-3-1000" class="btn">Learn More</a>
                </div>
            </div>
    
            <div class="portfolio-box">
                <div class="portfolio-img">
                    <img src="images/womens-multivitamin.jpg" alt="Nutralux Women's Multivitamin bottle" />
                </div>
                <div class="portfolio-content">
                    <h4>Women's Multivitamin</h4>
                    <p>Daily balance and support</p>
                    <a href="product.html?slug=womens-multivitamin" class="btn">Learn More</a>
                </div>
            </div>
        </div>
    
        <div style="text-align:center; margin-top: 1.5rem;">
            <a href="catalog.html" class="btn">View Full Catalog</a>
        </div>
    </section>
    <section class="faq" id="faq">
        <h2 class="heading">Frequently Asked <span>Questions about Nutralux</span></h2>
    
        <div class="faq-container">
            <div class="faq-item">
                <h3>How fast is delivery?</h3>
                <p>Delivery usually takes 1-2 business days. We ship orders on the same day they are placed.</p>
            </div>
    
            <div class="faq-item">
                <h3>Can children take your vitamins?</h3>
                <p>Yes, we have special complexes for children. Please check the "For Kids" section in our catalog.</p>
            </div>
    
            <div class="faq-item">
                <h3>Are there discounts for multiple items?</h3>
                <p>Yes, for orders of 3 or more items, we offer discounts and free shipping.</p>
            </div>
    
            <div class="faq-item">
                <h3>What payment methods are available?</h3>
                <p>We accept card payments, e-wallets, and cash on delivery.</p>
            </div>
        </div>
    </section>
    <footer class="footer">
        <div class="footer-text">
            <p>¬© 2025 Nutralux</p>
        </div>

        <div class="footer-icon-top">
            <a href="#home"><i class="bx bx-up-arrow-alt"></i></a>
        </div>
    </footer>

    <div id="chat-fab" style="display: flex;">
        <i class="bx bx-chat"></i>
    </div>

    <div id="chat-widget" style="display: none;">
        <div class="chat-container">
            <div class="chat-header">–ß–∞—Ç-–±–æ—Ç Nutralux</div>
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    <strong>–ë–æ—Ç:</strong> –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø —á–∞—Ç-–±–æ—Ç Nutralux. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?
                </div>
            </div>
            <div class="chat-input-container">
                <input type="text" class="chat-input" id="chat-input" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
                <button class="chat-send" id="chat-send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/scrollreveal"></script>

    <script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>

    <script src="script.js"></script>
    <script>
        /* to prevent Typed.js from breaking on pages without .multiple-text */
        if (typeof Typed !== 'undefined' && document.querySelector('.multiple-text')) {
            new Typed('.multiple-text', {
                strings: ['vitamins and supplements', 'daily health'],
                typeSpeed: 100,
                backSpeed: 100,
                backDelay: 1000,
                loop: true
            });
        }
<script>
    // --- –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï –ò –°–û–°–¢–û–Ø–ù–ò–ï ---
    let lastLanguage = 'ru';
    let currentContext = null; // –î–ª—è –ø–∞–º—è—Ç–∏ –æ –¥–∏–∞–ª–æ–≥–µ
    let isLoading = false; // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥–≤–æ–π–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É

    // --- –ü–†–ò–í–Ø–ó–ö–ê –ö DOM ---
    const chatWidget = document.getElementById('chat-widget');
    const chatFab = document.getElementById('chat-fab');
    const chatInput = document.getElementById('chat-input');
    const chatSend = document.getElementById('chat-send');
    const chatMessages = document.getElementById('chat-messages');
    // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
    const chatQuickReplies = document.getElementById('chat-quick-replies');
    const chatClear = document.getElementById('chat-clear');

    // --- –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–ï–†–ï–ö–õ–Æ–ß–ï–ù–ò–Ø –ß–ê–¢–ê ---
    function toggleChat() {
        if (!chatWidget || !chatFab || !chatInput) {
            console.error("–≠–ª–µ–º–µ–Ω—Ç—ã —á–∞—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ DOM.");
            return;
        }

        const isHidden = chatWidget.style.display === 'none' || chatWidget.style.display === '';
        chatWidget.style.display = isHidden ? 'flex' : 'none';
        chatFab.innerHTML = isHidden ? '<i class="bx bx-x"></i>' : '<i class="bx bx-chat"></i>';

        if (isHidden) {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –∏ —Ä–µ–Ω–¥–µ—Ä–∏–º
            const history = loadChatHistory();
            renderChatFromHistory(history);
            
            // –ï—Å–ª–∏ –∏—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
            if (history.length === 0) {
                const welcomeMsg = getAIResponse("start_conversation", []); // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç—Ä–∏–≥–≥–µ—Ä
                addMessage(welcomeMsg, 'bot');
                renderQuickReplies(['–ò–º–º—É–Ω–∏—Ç–µ—Ç', '–°–æ–Ω', '–≠–Ω–µ—Ä–≥–∏—è']);
            }
            setTimeout(() => chatInput.focus(), 100);
        }
    }

    // --- –ë–ï–ó–û–ü–ê–°–ù–ê–Ø –í–°–¢–ê–í–ö–ê HTML (–°–ê–ù–ò–¢–ê–ô–ó–ï–†) ---
    function sanitize(text) {
        const element = document.createElement('div');
        element.textContent = text;
        return element.innerHTML;
    }

    // --- –ó–ê–ì–†–£–ó–ö–ê –î–ê–ù–ù–´–• (–°–ò–ú–£–õ–Ø–¶–ò–Ø API) ---
    async function fetchProducts() {
        // –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É —Å–µ—Ç–∏
        await new Promise(resolve => setTimeout(resolve, 300));

        // –î–ê–ù–ù–´–ï –ü–†–û–î–£–ö–¢–û–í –¢–ï–ü–ï–†–¨ –°–û–î–ï–†–ñ–ê–¢ 'usage' (–°–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è)
        const products = [
            { "slug": "/product/ginkgo-biloba-500", "name": "–ì–∏–Ω–∫–≥–æ –ë–∏–ª–æ–±–∞ 500 –º–≥", "short": "–ü–∞–º—è—Ç—å, –≤–Ω–∏–º–∞–Ω–∏–µ, –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –º–æ–∑–≥–∞", "category": "–†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ —ç–∫—Å—Ç—Ä–∞–∫—Ç—ã", "description": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–æ–∑–≥–æ–≤–æ–≥–æ –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏—è –∏ –∫–æ–≥–Ω–∏—Ç–∏–≤–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π: –ø–∞–º—è—Ç—å, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—è. –°–Ω–∏–∂–µ–Ω–∏–µ —à—É–º–∞ –≤ —É—à–∞—Ö –∏ –≥–æ–ª–æ–≤–æ–∫—Ä—É–∂–µ–Ω–∏—è, –ø–æ–º–æ—â—å –ø—Ä–∏ —É—Ç–æ–º–ª–µ–Ω–∏–∏.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 –∫–∞–ø—Å—É–ª–µ –≤ –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∫—É—Ä—Å - 3 –º–µ—Å—è—Ü–∞." },
            { "slug": "/product/magnesium-b6", "name": "–ú–∞–≥–Ω–∏–π B6", "short": "–ù–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, —Å–æ–Ω, —É—Å–≤–æ–µ–Ω–∏–µ –º–∞–≥–Ω–∏—è", "category": "–ú–∏–Ω–µ—Ä–∞–ª—ã", "description": "–ú–∞–≥–Ω–∏–π —É—á–∞—Å—Ç–≤—É–µ—Ç –≤–æ –º–Ω–æ–∂–µ—Å—Ç–≤–µ –æ–±–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤, –ø–æ–º–æ–≥–∞–µ—Ç –ø—Ä–∏ —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Å–ø–∞–∑–º–∞—Ö –º—ã—à—Ü –∏ –Ω–∞—Ä—É—à–µ–Ω–∏—è—Ö —Å–Ω–∞. –í–∏—Ç–∞–º–∏–Ω B6 –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –Ω–µ—Ä–≤–Ω—É—é —Å–∏—Å—Ç–µ–º—É.", "usage": "–í–∑—Ä–æ—Å–ª—ã–º –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1-2 —Ç–∞–±–ª–µ—Ç–∫–∏ 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞ - 1 –º–µ—Å—è—Ü." },
            { "slug": "/product/omega-3-1000", "name": "–û–º–µ–≥–∞-3 1000 –º–≥", "short": "–ú–æ–∑–≥, —Å–µ—Ä–¥—Ü–µ, –∑—Ä–µ–Ω–∏–µ", "category": "–ñ–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã", "description": "–ù–µ–∑–∞–º–µ–Ω–∏–º—ã–µ –∂–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–æ–∑–≥–∞ –∏ —Å–µ—Ä–¥–µ—á–Ω–æ-—Å–æ—Å—É–¥–∏—Å—Ç–æ–π —Å–∏—Å—Ç–µ–º—ã, –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞ –∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–∂–∏ –∏ –∑—Ä–µ–Ω–∏—è.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 –∫–∞–ø—Å—É–ª–µ 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –ö—É—Ä—Å –ø—Ä–∏–µ–º–∞ - 1-2 –º–µ—Å—è—Ü–∞." },
            { "slug": "/product/b-complex", "name": "–í–∏—Ç–∞–º–∏–Ω B-–∫–æ–º–ø–ª–µ–∫—Å", "short": "–≠–Ω–µ—Ä–≥–∏—è, –Ω–µ—Ä–≤–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫—Ä–æ–≤—å", "category": "–í–∏—Ç–∞–º–∏–Ω—ã", "description": "–ö–æ–º–ø–ª–µ–∫—Å –≤–∏—Ç–∞–º–∏–Ω–æ–≤ –≥—Ä—É–ø–ø—ã B –¥–ª—è —ç–Ω–µ—Ä–≥–æ–æ–±–º–µ–Ω–∞, —Ä–∞–±–æ—Ç—ã –¶–ù–° –∏ –∫—Ä–æ–≤–µ—Ç–≤–æ—Ä–µ–Ω–∏—è. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–µ–∑ –≥–µ–º–æ–≥–ª–æ–±–∏–Ω–∞ –∏ –æ–±–º–µ–Ω —É–≥–ª–µ–≤–æ–¥–æ–≤.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 –∫–∞–ø—Å—É–ª–µ –≤ –¥–µ–Ω—å —É—Ç—Ä–æ–º –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–∞ - 1 –º–µ—Å—è—Ü." },
            { "slug": "/product/anti-stress", "name": "–ê–Ω—Ç–∏-–°—Ç—Ä–µ—Å—Å", "short": "–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ, —Å–æ–Ω, —Å–Ω–∏–∂–µ–Ω–∏–µ —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç–∏", "category": "–†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ —ç–∫—Å—Ç—Ä–∞–∫—Ç—ã", "description": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø—Ä–∏ —Ç—Ä–µ–≤–æ–≥–µ –∏ –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–∏, –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–Ω–∞. –†–∞—Å—Ç–∏—Ç–µ–ª—å–Ω—ã–µ —ç–∫—Å—Ç—Ä–∞–∫—Ç—ã –∑–≤–µ—Ä–æ–±–æ—è, –ø–∞—Å—Å–∏—Ñ–ª–æ—Ä—ã –∏ –≤–∞–ª–µ—Ä–∏–∞–Ω—ã.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 –∫–∞–ø—Å—É–ª–µ 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å (—É—Ç—Ä–æ–º –∏ –≤–µ—á–µ—Ä–æ–º). –î–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å–Ω–∞ –º–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å 2 –∫–∞–ø—Å—É–ª—ã –∑–∞ —á–∞—Å –¥–æ —Å–Ω–∞." },
            { "slug": "/product/vitamin-d3-10000", "name": "–í–∏—Ç–∞–º–∏–Ω D3 10 000 –ú–ï", "short": "–ò–º–º—É–Ω–∏—Ç–µ—Ç, –∫–∞–ª—å—Ü–∏–µ–≤—ã–π –æ–±–º–µ–Ω, —Å–æ—Å—É–¥—ã", "category": "–í–∏—Ç–∞–º–∏–Ω—ã", "description": "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç –∏ –∑–¥–æ—Ä–æ–≤—ã–π –∫–∞–ª—å—Ü–∏–µ–≤—ã–π –æ–±–º–µ–Ω, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–æ—Å—É–¥–æ–≤ –∏ –ø—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–µ –∫–∞–ª—å—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ —Ç–∫–∞–Ω–µ–π.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 –∫–∞–ø—Å—É–ª–µ 1 —Ä–∞–∑ –≤ 2 –¥–Ω—è —É—Ç—Ä–æ–º –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ–Ω—Ç—Ä–æ–ª—å —É—Ä–æ–≤–Ω—è 25(OH)D –≤ –∫—Ä–æ–≤–∏." },
            { "slug": "/product/zinc-complex", "name": "–¶–∏–Ω–∫ (–∫–æ–º–ø–ª–µ–∫—Å)", "short": "–ò–º–º—É–Ω–∏—Ç–µ—Ç, –∫–æ–∂–∞, –æ–±–º–µ–Ω", "category": "–ú–∏–Ω–µ—Ä–∞–ª—ã", "description": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞, –∫–æ–∂–∏ –∏ –æ–±–º–µ–Ω–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –£—Å–∏–ª–µ–Ω –≤–∏—Ç–∞–º–∏–Ω–æ–º C, D –∏ —Å–µ–ª–µ–Ω–æ–º.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 —Ç–∞–±–ª–µ—Ç–∫–µ –≤ –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –∫—É—Ä—Å - 1 –º–µ—Å—è—Ü." },
            { "slug": "/product/probiotic-30b", "name": "–ü—Ä–æ–±–∏–æ—Ç–∏–∫", "short": "–ú–∏–∫—Ä–æ–±–∏–æ–º –∏ –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ", "category": "–ü—Ä–æ–±–∏–æ—Ç–∏–∫–∏", "description": "–ú—É–ª—å—Ç–∏—à—Ç–∞–º–º–æ–≤—ã–π –ø—Ä–æ–±–∏–æ—Ç–∏–∫: –∑–∞—â–∏—Ç–∞ –æ—Ç –ø–∞—Ç–æ–≥–µ–Ω–æ–≤, —Å–∏–Ω—Ç–µ–∑ –≤–∏—Ç–∞–º–∏–Ω–æ–≤, —É–ª—É—á—à–µ–Ω–∏–µ –≤—Å–∞—Å—ã–≤–∞–Ω–∏—è –º–∏–Ω–µ—Ä–∞–ª–æ–≤ –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 –∫–∞–ø—Å—É–ª–µ –≤ –¥–µ–Ω—å, –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Ç–æ—â–∞–∫ –∏–ª–∏ –ø–µ—Ä–µ–¥ —Å–Ω–æ–º. –ö—É—Ä—Å - 30 –¥–Ω–µ–π." },
            { "slug": "/product/collagen-30-sachets", "name": "–ö–æ–ª–ª–∞–≥–µ–Ω ‚Äî 30 —Å–∞—à–µ", "short": "–ö–æ–∂–∞, —Å—É—Å—Ç–∞–≤—ã, –≤–æ–ª–æ—Å—ã –∏ –Ω–æ–≥—Ç–∏", "category": "–ö–æ–ª–ª–∞–≥–µ–Ω", "description": "–¢—Ä–∏ —Ç–∏–ø–∞ –∫–æ–ª–ª–∞–≥–µ–Ω–∞ + –≤–∏—Ç–∞–º–∏–Ω C, –≥–∏–∞–ª—É—Ä–æ–Ω–æ–≤–∞—è –∫–∏—Å–ª–æ—Ç–∞, –∫–æ—ç–Ω–∑–∏–º Q10, —Ü–∏–Ω–∫, –±–∏–æ—Ç–∏–Ω –¥–ª—è –∫–æ–∂–∏, —Å—É—Å—Ç–∞–≤–æ–≤ –∏ –æ–±—â–µ–≥–æ —Ç–æ–Ω—É—Å–∞.", "usage": "–†–∞—Å—Ç–≤–æ—Ä–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ 1 —Å–∞—à–µ –≤ 100-150 –º–ª –≤–æ–¥—ã –∏–ª–∏ —Å–æ–∫–∞. –ü—Ä–∏–Ω–∏–º–∞—Ç—å 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å –Ω–∞—Ç–æ—â–∞–∫, –∑–∞ 30 –º–∏–Ω—É—Ç –¥–æ –µ–¥—ã." },
            { "slug": "/product/vitamin-c-effervescent-1000", "name": "–í–∏—Ç–∞–º–∏–Ω C 1000 –º–≥ (—à–∏–ø—É—á–∏–π)", "short": "–ò–º–º—É–Ω–∏—Ç–µ—Ç, –∞–Ω—Ç–∏–æ–∫—Å–∏–¥–∞–Ω—Ç, –∫–æ–ª–ª–∞–≥–µ–Ω", "category": "–í–∏—Ç–∞–º–∏–Ω—ã", "description": "–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∏–º–º—É–Ω–∏—Ç–µ—Ç, —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Å—É–¥–æ–≤ –∏ –∫–æ–∂–∏, —É–ª—É—á—à–∞–µ—Ç —É—Å–≤–æ–µ–Ω–∏–µ –∂–µ–ª–µ–∑–∞ –∏ —Å–∏–Ω—Ç–µ–∑ –∫–æ–ª–ª–∞–≥–µ–Ω–∞.", "usage": "–†–∞—Å—Ç–≤–æ—Ä–∏—Ç—å 1 —à–∏–ø—É—á—É—é —Ç–∞–±–ª–µ—Ç–∫—É –≤ —Å—Ç–∞–∫–∞–Ω–µ –≤–æ–¥—ã (200 –º–ª). –ü—Ä–∏–Ω–∏–º–∞—Ç—å 1 —Ä–∞–∑ –≤ –¥–µ–Ω—å –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –ö—É—Ä—Å 10-20 –¥–Ω–µ–π." },
            { "slug": "/product/womens-multivitamin", "name": "–ñ–µ–Ω—Å–∫–∏–π –ú—É–ª—å—Ç–∏–≤–∏—Ç–∞–º–∏–Ω", "short": "–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –±–∞–ª–∞–Ω—Å, —É—Å–≤–æ–µ–Ω–∏–µ –¥–æ 98%", "category": "–ö–æ–º–ø–ª–µ–∫—Å—ã", "description": "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å –¥–ª—è –∂–µ–Ω—Å–∫–æ–≥–æ –æ—Ä–≥–∞–Ω–∏–∑–º–∞: –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ, –∏–º–º—É–Ω–∏—Ç–µ—Ç, –º–µ—Ç–∞–±–æ–ª–∏–∑–º, –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–∂–∏ –∏ —ç–Ω–µ—Ä–≥–∏–∏.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 1 —Ç–∞–±–ª–µ—Ç–∫–µ 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å (—É—Ç—Ä–æ–º –∏ –¥–Ω–µ–º) –≤–æ –≤—Ä–µ–º—è –µ–¥—ã. –ö—É—Ä—Å - 1 –º–µ—Å—è—Ü." },
            { "slug": "/product/slimming-complex", "name": "–°–ª–∏–º–º–∏–Ω–≥ –ö–æ–º–ø–ª–µ–∫—Å", "short": "–¢–æ–Ω—É—Å, –º–µ—Ç–∞–±–æ–ª–∏–∑–º –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–ø–ø–µ—Ç–∏—Ç–∞", "category": "–ö–æ–º–ø–ª–µ–∫—Å—ã", "description": "–¢–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–∏–∂–µ–Ω–∏—è –≤–µ—Å–∞: –≥—É–∞—Ä–∞–Ω–∞, –∑–µ–ª—ë–Ω—ã–π —á–∞–π, CLA, L-–∫–∞—Ä–Ω–∏—Ç–∏–Ω, –≥–∞—Ä—Ü–∏–Ω–∏—è, –∫–æ—Ä–∏—Ü–∞, –≥–∏–º–Ω–µ–º–∞, 5-HTP –∏ —Ö—Ä–æ–º.", "usage": "–ü—Ä–∏–Ω–∏–º–∞—Ç—å –ø–æ 2 –∫–∞–ø—Å—É–ª—ã 2 —Ä–∞–∑–∞ –≤ –¥–µ–Ω—å –∑–∞ 30 –º–∏–Ω—É—Ç –¥–æ –µ–¥—ã (—É—Ç—Ä–æ–º –∏ –≤ –æ–±–µ–¥), –∑–∞–ø–∏–≤–∞—è —Å—Ç–∞–∫–∞–Ω–æ–º –≤–æ–¥—ã." }
        ];

        return products;
    }

    // --- –û–ë–†–ê–ë–û–¢–ö–ê –û–ü–ï–ß–ê–¢–û–ö (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
    function normalizeText(text) {
        const lowerText = text.toLowerCase().trim();
        const corrections = {
            '–º': '–∏–º–º—É–Ω–∏—Ç–µ—Ç', '–∏–º—É–Ω–∏—Ç–µ—Ç': '–∏–º–º—É–Ω–∏—Ç–µ—Ç', 'immunity': '–∏–º–º—É–Ω–∏—Ç–µ—Ç', '–∏–º–º—É–Ω': '–∏–º–º—É–Ω–∏—Ç–µ—Ç',
            '—Å–Ω': '—Å–æ–Ω', '—Å–ø–∞—Ç—å': '—Å–æ–Ω', '–±–µ—Å—Å–æ–Ω–Ω–∏—Ü–∞': '—Å–æ–Ω', 'sleep': '—Å–æ–Ω',
            '—ç–Ω–µ—Ä–≥–∏—è': '—ç–Ω–µ—Ä–≥–∏—è', '—ç–Ω–µ–≥–∏—è': '—ç–Ω–µ—Ä–≥–∏—è', '—Å–∏–ª—ã': '—ç–Ω–µ—Ä–≥–∏—è', 'energy': '—ç–Ω–µ—Ä–≥–∏—è', '—É—Å—Ç–∞–ª–æ—Å—Ç—å': '—ç–Ω–µ—Ä–≥–∏—è',
            '–º–æ–∑–≥': '–º–æ–∑–≥', '–º–∑–≥': '–º–æ–∑–≥', '–ø–∞–º—è—Ç—å': '–º–æ–∑–≥', '–≤–Ω–∏–º–∞–Ω–∏–µ': '–º–æ–∑–≥', 'brain': '–º–æ–∑–≥',
            '–∫–æ–∂–∞': '–∫–æ–∂–∞', '–≤–æ–ª–æ—Å—ã': '–∫–æ–∂–∞', '–Ω–æ–≥—Ç–∏': '–∫–æ–∂–∞', 'skin': '–∫–æ–∂–∞', 'beauty': '–∫–æ–∂–∞',
            '–≤–µ—Å': '–≤–µ—Å', '–ø–æ—Ö—É–¥–µ–Ω–∏–µ': '–≤–µ—Å', '–¥–∏–µ—Ç–∞': '–≤–µ—Å', 'slim': '–≤–µ—Å', '–ø–æ—Ö—É–¥–µ—Ç—å': '–≤–µ—Å',
            '—Å–µ—Ä–¥—Ü–µ': '—Å–µ—Ä–¥—Ü–µ', '—Å–æ—Å—É–¥—ã': '—Å–µ—Ä–¥—Ü–µ', 'heart': '—Å–µ—Ä–¥—Ü–µ', '–æ–º–µ–≥–∞': '—Å–µ—Ä–¥—Ü–µ',
            '–∂–µ–ª—É–¥–æ–∫': '–∂–µ–ª—É–¥–æ–∫', '–ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏–µ': '–∂–µ–ª—É–¥–æ–∫', '–∫–∏—à–µ—á–Ω–∏–∫': '–∂–µ–ª—É–¥–æ–∫', 'digest': '–∂–µ–ª—É–¥–æ–∫', '–ø—Ä–æ–±–∏–æ—Ç–∏–∫': '–∂–µ–ª—É–¥–æ–∫'
        };
        
        let normalized = lowerText;
        Object.keys(corrections).forEach(wrong => {
            const regex = new RegExp(`\\b${wrong}\\b`, 'gi');
            normalized = normalized.replace(regex, corrections[wrong]);
        });
        return normalized;
    }

    // --- –û–ü–†–ï–î–ï–õ–ï–ù–ò–ï –Ø–ó–´–ö–ê (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π) ---
    function detectLanguage(text) {
        const russianChars = /[–∞-—è—ë]/i;
        const englishChars = /[a-z]/i;
        const hasRu = russianChars.test(text);
        const hasEn = englishChars.test(text);
        
        if (hasRu && !hasEn) return 'ru';
        if (hasEn && !hasRu) return 'en';
        if (hasRu && hasEn) {
            const ruWords = text.match(/[–∞-—è—ë]+/gi) || [];
            const enWords = text.match(/[a-z]+/gi) || [];
            return ruWords.length >= enWords.length ? 'ru' : 'en';
        }
        return lastLanguage;
    }

    // --- –õ–û–ì–ò–ö–ê –ò–ò-–û–¢–í–ï–¢–ê (–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞) ---
    function getAIResponse(message, products) {
        const normalizedMessage = normalizeText(message);
        const detectedLang = detectLanguage(message);
        lastLanguage = detectedLang;

        // --- 1. –ù–û–í–´–ô –ë–õ–û–ö: –ü–†–û–í–ï–†–ö–ê –ó–ê–ü–†–û–°–ê –û –ö–û–ù–ö–†–ï–¢–ù–û–ú –ü–†–û–î–£–ö–¢–ï ---
        // –≠—Ç–æ —Ç–∞–∫–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ö–û–ù–¢–ï–ö–°–¢–ê
        // –ï—Å–ª–∏ –±–æ—Ç –ø–æ–∫–∞–∑–∞–ª "–ú–∞–≥–Ω–∏–π B6", –∞ —é–∑–µ—Ä –ø–∏—à–µ—Ç "–ú–∞–≥–Ω–∏–π", —ç—Ç–æ—Ç –±–ª–æ–∫ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç
        
        // –£–ø—Ä–æ—â–∞–µ–º –ø–æ–∏—Å–∫: "–º–∞–≥–Ω–∏–π b6", "–º–∞–≥–Ω–∏–π", "–ø—Ä–æ–±–∏–æ—Ç–∏–∫"
        const simplifiedNames = products.map(p => ({
            ...p,
            simpleName: p.name.toLowerCase().split(' ')[0].replace('(', '')
        }));

        let foundProduct = null;
        for (const p of simplifiedNames) {
            if (normalizedMessage.includes(p.name.toLowerCase()) || 
                (p.simpleName.length > 3 && normalizedMessage.includes(p.simpleName))) {
                foundProduct = p;
                break;
            }
        }
        
        // –ù–û–í–´–ô –û–¢–í–ï–¢ –° –î–ï–¢–ê–õ–Ø–ú–ò –ò –ü–†–ò–ú–ï–ù–ï–ù–ò–ï–ú
        if (foundProduct) {
            clearContext(); // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç, —Ç–∞–∫ –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏–ª–∏ –Ω–∞ –≤–æ–ø—Ä–æ—Å
            renderQuickReplies(['–ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', '–ß—Ç–æ-–Ω–∏–±—É–¥—å –µ—â–µ?']);
            if (detectedLang === 'ru') {
                return `**–í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ "${foundProduct.name}":**\n\n` +
                       `**–û–ø–∏—Å–∞–Ω–∏–µ:** ${foundProduct.description}\n\n` +
                       `**–°–ø–æ—Å–æ–± –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:** ${foundProduct.usage}`;
            } else {
                return `**Here is the detailed info for "${foundProduct.name}":**\n\n` +
                       `**Description:** ${foundProduct.description}\n\n` +
                       `**How to use:** ${foundProduct.usage}`;
            }
        }

        // --- 2. –£–õ–£–ß–®–ï–ù–ù–´–ï –°–û–¶–ò–ê–õ–¨–ù–´–ï –û–¢–í–ï–¢–´ ---
        if (/(–ø—Ä–∏–≤–µ—Ç|–∑–¥—Ä–∞–≤—Å—Ç–≤|–¥–æ–±—Ä|—Ö–∞–π|–∫—É|start_conversation|hi|hello|hey|start)/.test(normalizedMessage)) {
            clearContext();
            renderQuickReplies(['–ò–º–º—É–Ω–∏—Ç–µ—Ç', '–°–æ–Ω', '–≠–Ω–µ—Ä–≥–∏—è']);
            return detectedLang === 'ru'
                ? "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! üëã –Ø AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç Nutralux. –°–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –æ –≤–∞—à–µ–π —Ü–µ–ª–∏, –∏ —è –ø–æ–¥–±–µ—Ä—É –∏–¥–µ–∞–ª—å–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å.\n\n–ù–∞–ø—Ä–∏–º–µ—Ä: '–ß—Ç–æ –ø–æ—Å–æ–≤–µ—Ç—É–µ—à—å –¥–ª—è —Å–Ω–∞ –∏ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞?' –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ '–∏–º–º—É–Ω–∏—Ç–µ—Ç'"
                : "Hello! I'm Nutralux AI consultant. Tell me your health goal and I'll find the perfect solution for you! üá¨üáß\n\nExample: 'What should I take for energy and focus?' or just 'immunity'";
        }

        const socialPatterns = {
            ru: {
                'how_are_you': /(–∫–∞–∫ –¥–µ–ª–∞|–∫–∞–∫ —Ç—ã|how are you)/,
                'thanks': /(—Å–ø–∞—Å–∏–±–æ|–±–ª–∞–≥–æ–¥–∞—Ä—é|–º–æ–ª–æ–¥–µ—Ü|–∫—Ä—É—Ç–æ|thanks|thank you)/,
                'who_are_you': /(—Ç—ã –∫—Ç–æ|–∫—Ç–æ —Ç—ã|who are you)/,
                'help': /(–ø–æ–º–æ—â—å|help|—á—Ç–æ —Ç—ã —É–º–µ–µ—à|–Ω–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º|what can you do)/
            }
        };

        if (socialPatterns.ru.how_are_you.test(normalizedMessage)) {
            clearContext();
            renderQuickReplies(['–°–æ–Ω', '–ò–º–º—É–Ω–∏—Ç–µ—Ç']);
            return detectedLang === 'ru' ? "–Ø –≤ –æ—Ç–ª–∏—á–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, —Å–ø–∞—Å–∏–±–æ! –ì–æ—Ç–æ–≤ –ø–æ–º–æ—á—å –≤–∞–º –≤—ã–±—Ä–∞—Ç—å –ª—É—á—à–∏–µ –¥–æ–±–∞–≤–∫–∏ –¥–ª—è **–∑–¥–æ—Ä–æ–≤—å—è –∏ —ç–Ω–µ—Ä–≥–∏–∏**.\n\n–ß—Ç–æ –¥–ª—è –≤–∞—Å —Å–µ–π—á–∞—Å –≤–∞–∂–Ω–µ–µ: **–°–æ–Ω** –∏–ª–∏ **–ò–º–º—É–Ω–∏—Ç–µ—Ç**?" : "I'm doing great, thank you! Ready to help you find the best supplements for **health and energy**.\n\nWhat is your main priority: **Sleep** or **Immunity**?";
        }
        if (socialPatterns.ru.thanks.test(normalizedMessage)) {
            clearContext();
            renderQuickReplies(['–≠–Ω–µ—Ä–≥–∏—è', '–ö—Ä–∞—Å–æ—Ç–∞']);
            return detectedLang === 'ru' ? "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞! üéâ –†–∞–¥, —á—Ç–æ —Å–º–æ–≥ –ø–æ–º–æ—á—å. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ —á—Ç–æ-—Ç–æ –µ—â–µ - –ø—Ä–æ—Å—Ç–æ —Å–ø—Ä–æ—Å–∏—Ç–µ!\n\n–ú–æ–∂–µ—Ç –±—ã—Ç—å, –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç —á—Ç–æ-—Ç–æ –¥–ª—è **—ç–Ω–µ—Ä–≥–∏–∏** –∏–ª–∏ **–∫—Ä–∞—Å–æ—Ç—ã**?" : "You're welcome! üéâ Glad I could help. If you need anything else - just ask!\n\nMaybe you're interested in something for **energy** or **beauty**?";
        }
        if (socialPatterns.ru.who_are_you.test(normalizedMessage)) {
            clearContext();
            renderQuickReplies(['–ß—Ç–æ —Ç–µ–±—è –±–µ—Å–ø–æ–∫–æ–∏—Ç?']); // –≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –ø—Ä–∏–º–µ—Ä
            return detectedLang === 'ru' ? "–Ø - AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç Nutralux! ü§ñ –ü–æ–º–æ–≥–∞—é –ø–æ–¥–æ–±—Ä–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω—ã–µ –≤–∏—Ç–∞–º–∏–Ω—ã –∏ –¥–æ–±–∞–≤–∫–∏ –¥–ª—è –≤–∞—à–∏—Ö —Ü–µ–ª–µ–π –∑–¥–æ—Ä–æ–≤—å—è.\n\n–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –±–µ—Å–ø–æ–∫–æ–∏—Ç?" : "I'm Nutralux AI consultant! ü§ñ I help choose perfect vitamins and supplements for your health goals.\n\nTell me, what concerns you?";
        }
        if (socialPatterns.ru.help.test(normalizedMessage)) {
            clearContext();
            renderQuickReplies(['üí§ –°–æ–Ω', '‚ö° –≠–Ω–µ—Ä–≥–∏—è', 'üõ°Ô∏è –ò–º–º—É–Ω–∏—Ç–µ—Ç', 'üíÖ –ö—Ä–∞—Å–æ—Ç–∞']);
            return detectedLang === 'ru' ? "–Ø –ø–æ–º–æ–≥—É –ø–æ–¥–æ–±—Ä–∞—Ç—å –¥–æ–±–∞–≤–∫–∏ –¥–ª—è:\n\n‚Ä¢ üí§ **–°–Ω–∞ –∏ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è**\n‚Ä¢ üß† **–ü–∞–º—è—Ç–∏ –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏**\n‚Ä¢ ‚ö° **–≠–Ω–µ—Ä–≥–∏–∏ –∏ —Ç–æ–Ω—É—Å–∞**\n‚Ä¢ üõ°Ô∏è **–ò–º–º—É–Ω–∏—Ç–µ—Ç–∞**\n‚Ä¢ üíÖ **–ö—Ä–∞—Å–æ—Ç—ã –∫–æ–∂–∏ –∏ –≤–æ–ª–æ—Å**\n\n–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏—Ç–µ, —á—Ç–æ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É–µ—Ç!" : "I can help choose supplements for:\n\n‚Ä¢ üí§ **Sleep and relaxation**\n‚Ä¢ üß† **Memory and focus**\n‚Ä¢ ‚ö° **Energy and vitality**\n‚Ä¢ üõ°Ô∏è **Immunity**\n‚Ä¢ üíÖ **Skin and hair beauty**\n\nJust tell me what interests you!";
        }

        // --- 3. –õ–û–ì–ò–ö–ê –ü–û–ò–°–ö–ê –ü–†–û–î–£–ö–¢–û–í ---
        const productMap = {
            sleep: /(—Å–æ–Ω|–±–µ—Å—Å–æ–Ω–Ω–∏—Ü|—Å–ø–∞—Ç—å|–∑–∞—Å—ã–ø–∞–Ω–∏–µ|—Ç—Ä–µ–≤–æ–≥|stress|sleep|insomnia)/,
            brain: /(–º–æ–∑–≥|–ø–∞–º—è—Ç|–∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü|–≤–Ω–∏–º–∞–Ω–∏–µ|—Ñ–æ–∫—É—Å|brain|memory|focus)/,
            energy: /(—ç–Ω–µ—Ä–≥–∏|—Å–∏–ª|–±–æ–¥—Ä|—Å–ª–∞–±–æ—Å—Ç|—É—Å—Ç–∞–ª|—É—Ç–æ–º–ª–µ–Ω|energy|fatigue)/,
            immunity: /(–∏–º–º—É–Ω–∏—Ç|–∑–∞—â–∏—Ç|–ø—Ä–æ—Å—Ç—É–¥–∞|–≤–∏—Ä—É—Å|–∑–¥–æ—Ä–æ–≤—å–µ|immun|defense)/,
            beauty: /(–∫–æ–∂|–≤–æ–ª–æ—Å|–Ω–æ–≥—Ç|–∫—Ä–∞—Å–æ—Ç|–∫–æ–ª–ª–∞–≥–µ–Ω|skin|hair|nails|beauty)/,
            weight: /(–≤–µ—Å|–ø–æ—Ö—É–¥–µ–Ω|—Å—Ç—Ä–æ–π–Ω|–¥–∏–µ—Ç|–º–µ—Ç–∞–±–æ–ª–∏–∑–º|slim|diet)/,
            heart: /(—Å–µ—Ä–¥—Ü|—Å–æ—Å—É–¥|–¥–∞–≤–ª–µ–Ω|–æ–º–µ–≥–∞|heart|pressure)/,
            stomach: /(–∂–µ–ª—É–¥–æ–∫|–ø–∏—â–µ–≤–∞—Ä|–∫–∏—à–µ—á–Ω–∏–∫|–ø—Ä–æ–±–∏–æ—Ç–∏–∫|digest|probiotic)/,
        };

        const keywordsFound = Object.keys(productMap).filter(key => productMap[key].test(normalizedMessage));

        // --- 4. –°–ï–ö–¶–ò–Ø –ö–û–ú–ë–ò–ù–ê–¶–ò–ô ---
        if (keywordsFound.length >= 2) {
            setContext({ topic: 'combination', products: [] }); // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
            renderQuickReplies(['–°–ø–∞—Å–∏–±–æ!', '–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ —Å–æ–Ω']);

            if (keywordsFound.includes('sleep') && keywordsFound.includes('immunity')) {
                setContext({ topic: 'sleep-immunity', products: ['magnesium-b6', 'vitamin-d3-10000', 'zinc-complex', 'vitamin-c-effervescent-1000'] });
                return detectedLang === 'ru' ? "üí§üõ°Ô∏è **–î–ª—è –∫—Ä–µ–ø–∫–æ–≥–æ —Å–Ω–∞ –∏ —Å–∏–ª—å–Ω–æ–≥–æ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞:**\n\n‚Ä¢ **–ú–∞–≥–Ω–∏–π B6** + **–í–∏—Ç–∞–º–∏–Ω D3** - –∏–¥–µ–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞!\n‚Ä¢ **–¶–∏–Ω–∫ –∫–æ–º–ø–ª–µ–∫—Å** - —É—Å–∏–ª–∏—Ç –∑–∞—â–∏—Ç—É –æ—Ä–≥–∞–Ω–∏–∑–º–∞\n‚Ä¢ **–í–∏—Ç–∞–º–∏–Ω C** - –ø–æ–¥–¥–µ—Ä–∂–∏—Ç –≤ —Å–µ–∑–æ–Ω –ø—Ä–æ—Å—Ç—É–¥\n\n‚≠ê **–ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ –≤–µ—á–µ—Ä–æ–º:** –ú–∞–≥–Ω–∏–π –¥–ª—è —Å–Ω–∞, —É—Ç—Ä–æ–º - D3 –∏ –¶–∏–Ω–∫ –¥–ª—è –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞!" : "üí§üõ°Ô∏è **For deep sleep and strong immunity:**\n\n‚Ä¢ **Magnesium B6** + **Vitamin D3** - perfect combination!\n‚Ä¢ **Zinc Complex** - boosts body defense\n‚Ä¢ **Vitamin C** - supports during cold season\n\n‚≠ê **Take in evening:** Magnesium for sleep, in morning - D3 and Zinc for immunity!";
            }
            if (keywordsFound.includes('brain') && keywordsFound.includes('energy')) {
                setContext({ topic: 'brain-energy', products: ['ginkgo-biloba-500', 'omega-3-1000', 'b-complex'] });
                return detectedLang === 'ru' ? "üß†‚ö° **–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏ —è—Å–Ω–æ—Å—Ç—å —É–º–∞:**\n\n‚Ä¢ **–ì–∏–Ω–∫–≥–æ –ë–∏–ª–æ–±–∞** - —É–ª—É—á—à–∞–µ—Ç –∫—Ä–æ–≤–æ–æ–±—Ä–∞—â–µ–Ω–∏–µ –º–æ–∑–≥–∞\n‚Ä¢ **–û–º–µ–≥–∞-3** - –ø–∏—Ç–∞–µ—Ç –Ω–µ–π—Ä–æ–Ω—ã\n‚Ä¢ **B-–∫–æ–º–ø–ª–µ–∫—Å** - –¥–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é –Ω–∞ –≤–µ—Å—å –¥–µ–Ω—å\n\n‚≠ê **–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–æ–≤ –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª–æ–≤!**" : "üß†‚ö° **Maximum productivity and mental clarity:**\n\n‚Ä¢ **Ginkgo Biloba** - improves brain circulation\n‚Ä¢ **Omega-3** - nourishes neurons\n‚Ä¢ **B-Complex** - provides all-day energy\n\n‚≠ê **Perfect combination for students and professionals!**";
            }
        }

        // --- 5. –°–ï–ö–¶–ò–Ø –û–î–ò–ù–û–ß–ù–´–• –ö–ê–¢–ï–ì–û–†–ò–ô ---
        if (keywordsFound.length > 0) {
            const category = keywordsFound[0];
            let response = "";
            let productsList = [];
            let quickReplies = [];

            switch(category) {
                case 'sleep':
                    productsList = products.filter(p => p.short.includes('—Å–æ–Ω') || p.name.includes('–ú–∞–≥–Ω–∏–π') || p.name.includes('–°—Ç—Ä–µ—Å—Å'));
                    response = detectedLang === 'ru' ? "üò¥ **–î–ª—è –≥–ª—É–±–æ–∫–æ–≥–æ —Å–Ω–∞ –∏ —Å–ø–æ–∫–æ–π–Ω–æ–π –Ω–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã:**\n\n" : "üò¥ **For deep sleep and calm nervous system:**\n\n";
                    quickReplies = ['–ü—Ä–æ –ú–∞–≥–Ω–∏–π B6', '–ü—Ä–æ –ê–Ω—Ç–∏-–°—Ç—Ä–µ—Å—Å'];
                    break;
                case 'immunity':
                    productsList = products.filter(p => p.short.includes('–ò–º–º—É–Ω–∏—Ç–µ—Ç') || p.name.includes('–¶–∏–Ω–∫') || p.name.includes('–í–∏—Ç–∞–º–∏–Ω C') || p.name.includes('–í–∏—Ç–∞–º–∏–Ω D'));
                    response = detectedLang === 'ru' ? "üõ°Ô∏è **–î–ª—è —Å–∏–ª—å–Ω–æ–≥–æ –∏–º–º—É–Ω–∏—Ç–µ—Ç–∞ –∏ –∑–∞—â–∏—Ç—ã:**\n\n" : "üõ°Ô∏è **For strong immunity and protection:**\n\n";
                    quickReplies = ['–ü—Ä–æ –¶–∏–Ω–∫', '–ü—Ä–æ –í–∏—Ç–∞–º–∏–Ω D3'];
                    break;
                case 'energy':
                    productsList = products.filter(p => p.short.includes('–≠–Ω–µ—Ä–≥–∏—è') || p.name.includes('B-–∫–æ–º–ø–ª–µ–∫—Å') || p.name.includes('–ú—É–ª—å—Ç–∏–≤–∏—Ç–∞–º–∏–Ω'));
                    response = detectedLang === 'ru' ? "‚ö° **–î–ª—è —ç–Ω–µ—Ä–≥–∏–∏ –∏ –∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö —Å–∏–ª:**\n\n" : "‚ö° **For energy and vitality:**\n\n";
                    quickReplies = ['–ü—Ä–æ B-–∫–æ–º–ø–ª–µ–∫—Å', '–ñ–µ–Ω—Å–∫–∏–π –ú—É–ª—å—Ç–∏–≤–∏—Ç–∞–º–∏–Ω'];
                    break;
                case 'brain':
                    productsList = products.filter(p => p.short.includes('–º–æ–∑–≥') || p.short.includes('–ø–∞–º—è—Ç—å') || p.name.includes('–ì–∏–Ω–∫–≥–æ') || p.name.includes('–û–º–µ–≥–∞'));
                    response = detectedLang === 'ru' ? "üß† **–î–ª—è –ø–∞–º—è—Ç–∏ –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏:**\n\n" : "üß† **For memory and focus:**\n\n";
                    quickReplies = ['–ü—Ä–æ –ì–∏–Ω–∫–≥–æ –ë–∏–ª–æ–±–∞', '–ü—Ä–æ –û–º–µ–≥–∞-3'];
                    break;
                case 'beauty':
                    productsList = products.filter(p => p.short.includes('–∫–æ–∂–∞') || p.name.includes('–ö–æ–ª–ª–∞–≥–µ–Ω') || p.name.includes('–¶–∏–Ω–∫') || p.short.includes('–≤–æ–ª–æ—Å'));
                    response = detectedLang === 'ru' ? "üíÖ **–î–ª—è –∫—Ä–∞—Å–æ—Ç—ã –∫–æ–∂–∏ –∏ –≤–æ–ª–æ—Å:**\n\n" : "üíÖ **For skin and hair beauty:**\n\n";
                    quickReplies = ['–ü—Ä–æ –ö–æ–ª–ª–∞–≥–µ–Ω', '–ü—Ä–æ –¶–∏–Ω–∫'];
                    break;
                default:
                    productsList = [];
            }

            if (productsList.length > 0) {
                // –°–û–ó–î–ê–ï–ú –°–°–´–õ–ö–ò –∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –°–ê–ù–ò–¢–ê–ô–ó–ï–†
                productsList.forEach(p => {
                    response += `‚Ä¢ <a href="${p.slug}" target="_blank"><strong>${sanitize(p.name)}</strong></a> - ${sanitize(p.short)}\n`;
                });
                
                // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–≤–µ—Ç
                const tips = { ru: { sleep: "\nüí° **–°–æ–≤–µ—Ç:** –ü—Ä–∏–Ω–∏–º–∞–π—Ç–µ –ú–∞–≥–Ω–∏–π B6 –∑–∞ 1-2 —á–∞—Å–∞ –¥–æ —Å–Ω–∞.", immunity: "\nüí° **–°–æ–≤–µ—Ç:** –í–∏—Ç–∞–º–∏–Ω—ã D3, C –∏ –¶–∏–Ω–∫ - –±–∞–∑–∞ –≤ –º–µ–∂—Å–µ–∑–æ–Ω—å–µ!", energy: "\nüí° **–°–æ–≤–µ—Ç:** B-–∫–æ–º–ø–ª–µ–∫—Å –ª—É—á—à–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —É—Ç—Ä–æ–º.", brain: "\nüí° **–°–æ–≤–µ—Ç:** –ì–∏–Ω–∫–≥–æ –ë–∏–ª–æ–±–∞ –∏ –û–º–µ–≥–∞-3 —Ä–∞–±–æ—Ç–∞—é—Ç –ª—É—á—à–µ –≤–º–µ—Å—Ç–µ!", beauty: "\nüí° **–°–æ–≤–µ—Ç:** –ö–æ–ª–ª–∞–≥–µ–Ω –ø—Ä–∏–Ω–∏–º–∞–π—Ç–µ –Ω–∞—Ç–æ—â–∞–∫." }, en: { sleep: "\nüí° **Tip:** Take Magnesium B6 1-2 hours before sleep.", immunity: "\nüí° **Tip:** Vitamins D3, C and Zinc are essential base!", energy: "\nüí° **Tip:** Take B-Complex in morning.", brain: "\nüí° **Tip:** Ginkgo Biloba and Omega-3 work better together!", beauty: "\nüí° **Tip:** Take Collagen on empty stomach." } };
                response += detectedLang === 'ru' ? (tips.ru[category] || "") : (tips.en[category] || "");
                
                // –£–°–¢–ê–ù–ê–í–õ–ò–í–ê–ï–ú –ö–û–ù–¢–ï–ö–°–¢
                setContext({ topic: category, products: productsList.map(p => p.slug) });
                renderQuickReplies(quickReplies);
                return response;
            }
        }

        // --- 6. –û–¢–í–ï–¢ –ü–û –£–ú–û–õ–ß–ê–ù–ò–Æ ---
        clearContext();
        renderQuickReplies(['–ò–º–º—É–Ω–∏—Ç–µ—Ç', '–°–æ–Ω', '–≠–Ω–µ—Ä–≥–∏—è']);
        if (detectedLang === 'ru') {
            return "ü§î **–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Ç–æ—á–Ω–∏—Ç–µ –≤–∞—à –∑–∞–ø—Ä–æ—Å!**\n\n–Ø —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Å—å –Ω–∞:\n‚Ä¢ üí§ **–°–æ–Ω –∏ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ**\n‚Ä¢ üß† **–ü–∞–º—è—Ç—å –∏ –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏—è**\n‚Ä¢ ‚ö° **–≠–Ω–µ—Ä–≥–∏—è –∏ —Ç–æ–Ω—É—Å**\n‚Ä¢ üõ°Ô∏è **–ò–º–º—É–Ω–∏—Ç–µ—Ç –∏ –∑–∞—â–∏—Ç–∞**\n\n–ù–∞–ø–∏—à–∏—Ç–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä: '–∏–º–º—É–Ω–∏—Ç–µ—Ç' –∏–ª–∏ '—Å–æ–Ω –∏ —ç–Ω–µ—Ä–≥–∏—è'";
        } else {
            return "ü§î **Please clarify your request!**\n\nI specialize in:\n‚Ä¢ üí§ **Sleep and relaxation**\n‚Ä¢ üß† **Memory and focus**\n‚Ä¢ ‚ö° **Energy and vitality**\n‚Ä¢ üõ°Ô∏è **Immunity and protection**\n\nWrite, for example: 'immunity' or 'sleep and energy'";
        }
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –°–û–û–ë–©–ï–ù–ò–Ø–ú–ò –ò –ò–°–¢–û–†–ò–ï–ô ---

    // –î–æ–±–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ DOM –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
    function addMessage(text, type = 'bot') {
        if (!chatMessages) return;

        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${type}-message`;

        const title = document.createElement('strong');
        if (type === 'user') {
            title.textContent = lastLanguage === 'ru' ? '–í—ã: ' : 'You: ';
            // –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨: –¢–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ textContent
            const content = document.createElement('span');
            content.textContent = text;
            messageDiv.appendChild(title);
            messageDiv.appendChild(content);
        } else {
            // –ë–û–¢: –û—Ç–≤–µ—Ç—ã –±–æ—Ç–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç HTML (—Å—Å—ã–ª–∫–∏, \n), –ø–æ—ç—Ç–æ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º innerHTML
            // –ú—ã –¥–æ–≤–µ—Ä—è–µ–º –Ω–∞—à–∏–º —à–∞–±–ª–æ–Ω–∞–º, –∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–∏–º–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤) –±—ã–ª–∏ –æ—á–∏—â–µ–Ω—ã
            title.textContent = lastLanguage === 'ru' ? '–ë–æ—Ç: ' : 'Bot: ';
            const content = document.createElement('span');
            content.innerHTML = text.replace(/\n/g, '<br>');
            messageDiv.appendChild(title);
            messageDiv.appendChild(content);
        }

        chatMessages.appendChild(messageDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
        saveChatHistory({ text, type });
    }

    // –†–µ–Ω–¥–µ—Ä–∏—Ç –∫–Ω–æ–ø–∫–∏ –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
    function renderQuickReplies(replies = []) {
        if (!chatQuickReplies) return;
        chatQuickReplies.innerHTML = '';
        if (replies.length === 0) return;

        replies.forEach(replyText => {
            const button = document.createElement('button');
            button.textContent = replyText;
            button.addEventListener('click', () => {
                chatInput.value = replyText;
                sendMessage();
            });
            chatQuickReplies.appendChild(button);
        });
    }

    // –ì–ª–∞–≤–Ω–∞—è –ê–°–ò–ù–•–†–û–ù–ù–ê–Ø —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏
    async function sendMessage() {
        if (!chatInput || !chatSend || !chatMessages || isLoading) return;

        const userMessage = chatInput.value.trim();
        if (!userMessage) return;

        isLoading = true;
        addMessage(userMessage, 'user');
        chatInput.value = '';
        chatSend.disabled = true;
        renderQuickReplies([]); // –û—á–∏—â–∞–µ–º –∫–Ω–æ–ø–∫–∏

        // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
        const typingIndicator = document.createElement('div');
        typingIndicator.id = 'typing-indicator';
        typingIndicator.className = 'message bot-message';
        const typingText = lastLanguage === 'ru' ? '–Ω–∞–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ...' : 'typing...';
        typingIndicator.innerHTML = `<strong>${lastLanguage === 'ru' ? '–ë–æ—Ç' : 'Bot'}:</strong> <em>${typingText}</em>`;
        chatMessages.appendChild(typingIndicator);
        chatMessages.scrollTop = chatMessages.scrollHeight;

        try {
            // 1. –ü–æ–ª—É—á–∞–µ–º –ø—Ä–æ–¥—É–∫—Ç—ã (—Å–∏–º—É–ª—è—Ü–∏—è API)
            const products = await fetchProducts();
            
            // 2. –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –ò–ò
            const aiResponse = getAIResponse(userMessage, products);

            // 3. –ò–º–∏—Ç–∏—Ä—É–µ–º –∑–∞–¥–µ—Ä–∂–∫—É "—Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π"
            setTimeout(() => {
                document.getElementById('typing-indicator')?.remove();
                addMessage(aiResponse, 'bot');
                chatSend.disabled = false;
                isLoading = false;
                chatInput.focus();
            }, 1200);

        } catch (error) {
            console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞:", error);
            document.getElementById('typing-indicator')?.remove();
            addMessage("–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.", 'error');
            chatSend.disabled = false;
            isLoading = false;
        }
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–°–¢–û–†–ò–ï–ô (localStorage) ---
    const CHAT_HISTORY_KEY = 'nutralux_chat_history';

    function saveChatHistory(message) {
        if (!message.text) return; // –ù–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø—É—Å—Ç—ã–µ
        const history = loadChatHistory();
        history.push(message);
        localStorage.setItem(CHAT_HISTORY_KEY, JSON.stringify(history));
    }

    function loadChatHistory() {
        const history = localStorage.getItem(CHAT_HISTORY_KEY);
        return history ? JSON.parse(history) : [];
    }

    function clearChatHistory() {
        localStorage.removeItem(CHAT_HISTORY_KEY);
        chatMessages.innerHTML = '';
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–Ω–æ–≤–æ
        const welcomeMsg = getAIResponse("start_conversation", []);
        addMessage(welcomeMsg, 'bot');
        renderQuickReplies(['–ò–º–º—É–Ω–∏—Ç–µ—Ç', '–°–æ–Ω', '–≠–Ω–µ—Ä–≥–∏—è']);
        clearContext();
    }
    
    // –†–µ–Ω–¥–µ—Ä–∏—Ç –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞ –∏–∑ localStorage
    function renderChatFromHistory(history) {
        chatMessages.innerHTML = '';
        history.forEach(msg => {
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º "—Ç–∏—Ö—É—é" –≤–µ—Ä—Å–∏—é addMessage, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∏—Å—Ç–æ—Ä–∏—é
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${msg.type}-message`;
            const title = document.createElement('strong');
            if (msg.type === 'user') {
                title.textContent = '–í—ã: ';
                const content = document.createElement('span');
                content.textContent = msg.text;
                messageDiv.appendChild(title);
                messageDiv.appendChild(content);
            } else {
                title.textContent = '–ë–æ—Ç: ';
                const content = document.createElement('span');
                content.innerHTML = msg.text.replace(/\n/g, '<br>');
                messageDiv.appendChild(title);
                messageDiv.appendChild(content);
            }
            chatMessages.appendChild(messageDiv);
        });
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // --- –£–ü–†–ê–í–õ–ï–ù–ò–ï –ö–û–ù–¢–ï–ö–°–¢–û–ú ---
    function setContext(context) {
        currentContext = context;
    }

    function clearContext() {
        currentContext = null;
    }

    // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –°–õ–£–®–ê–¢–ï–õ–ï–ô ---
    if (chatFab) {
        chatFab.addEventListener('click', toggleChat);
    }
    if (chatSend && chatInput) {
        chatSend.addEventListener('click', sendMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });
    }
    if (chatClear) {
        chatClear.addEventListener('click', clearChatHistory);
    }
    if (chatInput) {
        chatInput.addEventListener('focus', () => {
            chatInput.placeholder = lastLanguage === 'ru' ? "–ù–∞–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å..." : "Type your question...";
        });
    }

</script>
